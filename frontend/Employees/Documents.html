<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Documents | hrFlo</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #0a0a0a 0%, #0f0f0f 25%, #1a0f2e 50%, #0d0d0d 100%); color: #fff; min-height: 100vh; }
        .app { display: flex; }
        .sidebar { width: 280px; background: linear-gradient(135deg, #111111 0%, #1a1a2e 50%, #16213e 100%); border-right: 1px solid rgba(99, 102, 241, 0.1); position: fixed; height: 100vh; display: flex; flex-direction: column; z-index: 100;}
        .sidebar-header { padding: 24px 20px; border-bottom: 1px solid rgba(99, 102, 241, 0.1); }
        .brand-logo { font-size: 24px; font-weight: 700; }
        .nav { padding: 20px 12px; flex-grow: 1; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; color: rgba(255, 255, 255, 0.7); text-decoration: none; border-radius: 10px; }
        .nav-item i { font-size: 18px; width: 20px; text-align: center; }
        .nav-item:hover, .nav-item.active { background: rgba(99, 102, 241, 0.15); color: #fff; }
        .main { flex: 1; margin-left: 280px; padding: 20px 32px; }
        .page-header h1 { font-size: 32px; font-weight: 700; margin-bottom: 24px;}
        .card { background: linear-gradient(135deg, rgba(17, 17, 17, 0.9) 0%, rgba(26, 26, 46, 0.8) 100%); border: 1px solid rgba(99, 102, 241, 0.1); border-radius: 16px; padding: 32px; margin-bottom: 24px; }
        .card-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        .upload-section { border: 2px dashed rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 40px; text-align: center; background: rgba(99, 102, 241, 0.05); cursor: pointer; transition: all 0.3s ease; }
        .upload-section:hover { border-color: rgba(99, 102, 241, 0.5); background: rgba(99, 102, 241, 0.1); }
        .upload-icon { font-size: 40px; color: #6366f1; margin-bottom: 16px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px;}
        th, td { text-align: left; padding: 16px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        th { font-size: 12px; text-transform: uppercase; color: rgba(255, 255, 255, 0.6); }
        .btn-download { color: #6366f1; text-decoration: none; font-weight: 600; }
    </style>
</head>
<body>
    <div class="app">
        <aside class="sidebar">
            <header class="sidebar-header"><div class="brand-logo">hrFlo</div></header>
            <nav class="nav">
                <a class="nav-item" href="dashboard.html"><i class="fas fa-chart-line"></i><span>Dashboard</span></a>
                <a class="nav-item" href="personal_info.html"><i class="fas fa-user"></i><span>Personal Info</span></a>
                <a class="nav-item active" href="documents.html"><i class="fas fa-file"></i><span>Documents</span></a>
            </nav>
        </aside>
        <main class="main">
            <div class="page-header"><h1>My Documents</h1></div>
            <div class="card">
                <h2 class="card-title">Upload New Document</h2>
                <div class="upload-section" id="uploadArea">
                    <input type="file" id="fileInput" multiple hidden>
                    <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                    <p>Drag & drop files here, or click to browse</p>
                </div>
            </div>
            <div class="card">
                <h2 class="card-title">Uploaded Documents</h2>
                <table>
                    <thead><tr><th>Document Name</th><th>Category</th><th>Upload Date</th><th>Action</th></tr></thead>
                    <tbody id="documentsTableBody"></tbody>
                </table>
            </div>
        </main>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user) {
                window.location.href = '../auth/login.html';
                return;
            }

            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const documentsTableBody = document.getElementById('documentsTableBody');

            // --- Function to fetch and display documents ---
            const fetchDocuments = () => {
                fetch(`http://127.0.0.1:5000/api/employees/${user.userID}/documents`)
                    .then(res => res.json())
                    .then(docs => {
                        documentsTableBody.innerHTML = ''; // Clear existing rows
                        if (docs.length === 0) {
                             documentsTableBody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No documents uploaded yet.</td></tr>';
                        } else {
                            docs.forEach(doc => {
                                const row = `
                                    <tr>
                                        <td>${doc.documentName}</td>
                                        <td>${doc.category}</td>
                                        <td>${new Date(doc.uploadDate).toLocaleDateString()}</td>
                                        <td><a href="http://127.0.0.1:5000/api/documents/${doc.documentID}" class="btn-download" target="_blank">Download</a></td>
                                    </tr>
                                `;
                                documentsTableBody.innerHTML += row;
                            });
                        }
                    });
            };

            // --- Function to handle file upload ---
            const handleFiles = (files) => {
                const file = files[0];
                const category = prompt("Enter document category (e.g., 'Contract', 'ID', 'Certification'):", "General");
                if (!category) return; // User cancelled

                const formData = new FormData();
                formData.append('file', file);
                formData.append('category', category);

                fetch(`http://127.0.0.1:5000/api/employees/${user.userID}/documents`, {
                    method: 'POST',
                    body: formData,
                })
                .then(res => res.json())
                .then(data => {
                    alert(data.message);
                    fetchDocuments(); // Refresh the list
                })
                .catch(err => console.error('Upload failed:', err));
            };

            // --- Event Listeners ---
            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', () => handleFiles(fileInput.files));
            uploadArea.addEventListener('dragover', (e) => e.preventDefault());
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                handleFiles(e.dataTransfer.files);
            });

            // Initial fetch of documents
            fetchDocuments();
        });
    </script>
</body>
</html>

